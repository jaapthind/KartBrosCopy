<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>macOS Tahoe - Ultimate Developer Edition</title>
    <style>
        /* ==========================================================================
           1. KERNEL SYSTEM THEMING
           ========================================================================== */
        :root {
            --sf-font: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", Arial, sans-serif;
            --glass: rgba(255, 255, 255, 0.22);
            --glass-thick: rgba(255, 255, 255, 0.5);
            --glass-dark: rgba(15, 15, 15, 0.75);
            --blur: blur(60px) saturate(220%) brightness(1.1);
            --menu-h: 30px;
            --dock-h: 82px;
            --win-rad: 14px;
            --accent: #007aff;
            --shadow: 0 50px 100px rgba(0,0,0,0.5), 0 0 0 1px rgba(255,255,255,0.2) inset;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: var(--sf-font); -webkit-font-smoothing: antialiased; }
        body, html { width: 100vw; height: 100vh; overflow: hidden; background: #000; }

        /* ==========================================================================
           2. 4K LIVE TAHOE WALLPAPER ENGINE
           ========================================================================== */
        #wallpaper-engine { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; pointer-events: none; }
        #wallpaper-engine iframe {
            width: 140vw; height: 140vh; position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%); pointer-events: none;
        }
        #desktop-overlay { position: absolute; inset: 0; z-index: 2; background: linear-gradient(rgba(0,0,0,0.2), transparent 20%); pointer-events: none; }

        /* ==========================================================================
           3. UI CORE COMPONENTS
           ========================================================================== */
        #menu-bar {
            position: absolute; top: 0; width: 100%; height: var(--menu-h);
            background: rgba(255,255,255,0.12); backdrop-filter: var(--blur); -webkit-backdrop-filter: var(--blur);
            border-bottom: 0.5px solid rgba(255,255,255,0.2); display: flex; justify-content: space-between;
            align-items: center; padding: 0 15px; color: #fff; font-size: 13px; font-weight: 500; z-index: 1000000;
        }

        .dock-container { position: absolute; bottom: 12px; width: 100%; display: flex; justify-content: center; z-index: 1000000; }
        .dock {
            width: 96%; max-width: 1300px; height: var(--dock-h); background: var(--glass);
            backdrop-filter: var(--blur); border: 1px solid var(--glass-thick); border-radius: 26px;
            display: flex; align-items: flex-end; padding: 8px 18px; gap: 10px; box-shadow: 0 20px 50px rgba(0,0,0,0.4);
        }

        .dock-item { position: relative; width: 56px; height: 56px; transition: all 0.2s cubic-bezier(0.2, 1, 0.3, 1); }
        .dock-item svg { width: 100%; height: 100%; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.2)); cursor: pointer; }
        .dock-item:hover { transform: scale(1.4) translateY(-14px); margin: 0 12px; }
        .active-dot { position: absolute; bottom: -8px; left: 50%; transform: translateX(-50%); width: 4px; height: 4px; background: #fff; border-radius: 50%; opacity: 0; }
        .active-dot.on { opacity: 1; }

        /* ==========================================================================
           4. DYNAMIC WINDOWING SYSTEM
           ========================================================================== */
        #win-space { position: absolute; top: var(--menu-h); width: 100%; height: calc(100% - var(--menu-h)); z-index: 10; }
        .window {
            position: absolute; width: 800px; height: 550px; border-radius: var(--win-rad);
            background: rgba(245,245,247,0.88); backdrop-filter: var(--blur); box-shadow: var(--shadow);
            display: none; flex-direction: column; overflow: hidden; transform: scale(0.92); opacity: 0;
            transition: transform 0.3s cubic-bezier(0.2, 1, 0.3, 1), opacity 0.3s ease;
        }
        .window.show { display: flex; transform: scale(1); opacity: 1; }
        .window.dark { background: var(--glass-dark); color: #fff; }

        .title-bar { height: 42px; display: flex; align-items: center; padding: 0 14px; cursor: grab; background: linear-gradient(rgba(255,255,255,0.4), transparent); }
        .title-bar:active { cursor: grabbing; }
        .traffic-lights { display: flex; gap: 8px; width: 60px; }
        .light { width: 12px; height: 12px; border-radius: 50%; cursor: pointer; border: 0.5px solid rgba(0,0,0,0.1); }
        .close { background: #ff5f57; } .min { background: #febc2e; } .max { background: #28c840; }
        .win-title { flex: 1; text-align: center; font-size: 13px; font-weight: 600; color: #333; margin-left: -60px; }
        .dark .win-title { color: #fff; }

        .content { flex: 1; position: relative; }
        iframe { width: 100%; height: 100%; border: none; }
        .shield { position: absolute; inset: 0; z-index: 1000; display: none; }

        /* ==========================================================================
           5. BUILT-IN APPLICATIONS
           ========================================================================== */
        /* Calculator */
        .app-calc { display: flex; flex-direction: column; height: 100%; background: #1c1c1e; }
        .calc-display { height: 100px; color: #fff; font-size: 48px; display: flex; align-items: flex-end; justify-content: flex-end; padding: 10px 20px; font-weight: 300; }
        .calc-grid { display: grid; grid-template-columns: repeat(4, 1fr); flex: 1; gap: 1px; background: #333; }
        .calc-btn { background: #636366; color: white; border: none; font-size: 20px; cursor: pointer; }
        .calc-btn.op { background: #ff9f0a; }

        /* Terminal */
        .app-term { background: #000; color: #00ff00; padding: 15px; font-family: monospace; height: 100%; font-size: 14px; overflow-y: auto; }

        /* TicTacToe */
        .ttt-container { height: 100%; background: #111; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .ttt-grid { display: grid; grid-template-columns: repeat(3, 100px); gap: 10px; }
        .ttt-cell { width: 100px; height: 100px; background: #222; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 48px; font-weight: bold; color: #fff; cursor: pointer; }

        /* System Monitor */
        .sys-wrap { padding: 30px; color: #fff; }
        .sys-bar { height: 20px; background: #333; border-radius: 10px; overflow: hidden; margin: 15px 0; }
        .sys-fill { height: 100%; background: var(--accent); width: 0%; transition: width 0.5s ease; }
    </style>
</head>
<body>

    <div id="wallpaper-engine">
        <iframe src="https://www.youtube.com/embed/KT5zTS_BEjQ?autoplay=1&mute=1&loop=1&playlist=KT5zTS_BEjQ&controls=0&modestbranding=1&iv_load_policy=3&enablejsapi=1" frameborder="0"></iframe>
    </div>
    <div id="desktop-overlay"></div>

    <div id="menu-bar">
        <div style="display:flex; gap:18px; align-items:center;">
            <span style="font-size:18px;">ï£¿</span>
            <span id="active-app-name" style="font-weight:700;">Finder</span>
            <span>File</span><span>Edit</span><span>View</span><span>Go</span><span>Window</span>
        </div>
        <div style="display:flex; gap:15px; align-items:center;">
            <span>ðŸ”‹ 100%</span>
            <span>ðŸ“¶</span>
            <span id="clock">Wed Feb 25 7:33 PM</span>
        </div>
    </div>

    <div id="win-space"></div>

    <div class="dock-container">
        <div class="dock" id="dock"></div>
    </div>

    <script>
        /**
         * =========================================
         * SVG ICON ASSETS (Hard-coded for 100% Load)
         * =========================================
         */
        const ICONS = {
            finder: `<svg viewBox="0 0 100 100"><rect width="100" height="100" rx="22" fill="#E6F2FF"/><path d="M0 22C0 9 9 0 22 0h28v100H22C9 100 0 91 0 78V22z" fill="#007AFF"/><path d="M30 40c0-4 4-8 8-8s8 4 8 8-4 8-8 8-8-4-8-8zm32 0c0-4 4-8 8-8s8 4 8 8-4 8-8 8-8-4-8-8z" fill="#fff"/><path d="M46 65c5 10 15 10 15 0" stroke="#fff" stroke-width="4" fill="none"/></svg>`,
            safari: `<svg viewBox="0 0 100 100"><circle cx="50" cy="50" r="48" fill="#fff"/><circle cx="50" cy="50" r="42" fill="#007AFF"/><path d="M42 42l-10 25 25-10 10-25-25 10z" fill="#FF3B30"/><path d="M58 58l-25 10 10-25 25-10-10 25z" fill="#fff"/></svg>`,
            chat: `<svg viewBox="0 0 100 100"><rect width="100" height="100" rx="22" fill="#34C759"/><path d="M75 50c0 13-11 24-25 24-4 0-8-1-11-3L20 78l4-16c-3-4-4-8-4-12 0-13 11-24 25-24s25 11 25 24z" fill="#fff"/></svg>`,
            calc: `<svg viewBox="0 0 100 100"><rect width="100" height="100" rx="22" fill="#FF9500"/><circle cx="30" cy="50" r="5" fill="#fff"/><circle cx="50" cy="50" r="5" fill="#fff"/><circle cx="70" cy="50" r="5" fill="#fff"/></svg>`,
            term: `<svg viewBox="0 0 100 100"><rect width="100" height="100" rx="22" fill="#1C1C1E"/><path d="M25 35l15 15-15 15" fill="none" stroke="#34C759" stroke-width="6" stroke-linecap="round"/></svg>`,
            ttt: `<svg viewBox="0 0 100 100"><rect width="100" height="100" rx="22" fill="#5856D6"/><path d="M35 25v50M65 25v50M25 40h50M25 60h50" stroke="#fff" stroke-width="4"/></svg>`,
            sys: `<svg viewBox="0 0 100 100"><rect width="100" height="100" rx="22" fill="#FF2D55"/><path d="M20 70l20-40 20 30 20-50" stroke="#fff" stroke-width="5" fill="none"/></svg>`
        };

        const APP_DATA = [
            { id: 'finder', name: 'Finder', icon: ICONS.finder, type: 'iframe', url: 'https://en.wikipedia.org/wiki/MacOS' },
            { id: 'safari', name: 'Safari', icon: ICONS.safari, type: 'iframe', url: 'https://www.bing.com' },
            { id: 'chat', name: 'Liquid Chat', icon: ICONS.chat, type: 'chat', url: 'https://deadsimplechat.com/J4fFLy4Ek' },
            { id: 'calc', name: 'Calculator', icon: ICONS.calc, type: 'app_calc' },
            { id: 'term', name: 'Terminal', icon: ICONS.term, type: 'app_term' },
            { id: 'ttt', name: 'TicTacToe AI', icon: ICONS.ttt, type: 'app_ttt' },
            { id: 'sys', name: 'System Monitor', icon: ICONS.sys, type: 'app_sys' }
        ];

        /**
         * =========================================
         * KERNEL OBJECT-ORIENTED ENGINE
         * =========================================
         */
        class TahoeOS {
            constructor() {
                this.dock = document.getElementById('dock');
                this.space = document.getElementById('win-space');
                this.zIndex = 1000;
                this.windows = {};
                this.init();
            }

            init() {
                // Initialize Clock
                setInterval(() => {
                    const now = new Date();
                    document.getElementById('clock').innerText = now.toLocaleString('en-US', { weekday: 'short', month: 'short', day: 'numeric', hour: 'numeric', minute: '2-digit', hour12: true });
                }, 1000);

                // Initialize Dock
                APP_DATA.forEach(app => {
                    const el = document.createElement('div');
                    el.className = 'dock-item';
                    el.innerHTML = `${app.icon}<div class="active-dot" id="dot-${app.id}"></div>`;
                    el.onclick = () => this.launch(app.id);
                    this.dock.appendChild(el);
                });

                this.launch('chat'); // Auto-launch your chat
            }

            launch(id) {
                const app = APP_DATA.find(a => a.id === id);
                if (this.windows[id]) {
                    this.focus(id);
                    return;
                }

                const win = document.createElement('div');
                win.id = `win-${id}`;
                win.className = `window ${id === 'calc' || id === 'term' || id === 'sys' ? 'dark' : ''}`;
                win.style.left = `${150 + (Object.keys(this.windows).length * 30)}px`;
                win.style.top = `${80 + (Object.keys(this.windows).length * 30)}px`;
                
                win.innerHTML = `
                    <div class="title-bar" onmousedown="os.dragStart(event, '${id}')">
                        <div class="traffic-lights">
                            <div class="light close" onclick="os.terminate('${id}')"></div>
                            <div class="light min" onclick="os.hide('${id}')"></div>
                            <div class="light max"></div>
                        </div>
                        <div class="win-title">${app.name}</div>
                    </div>
                    <div class="content">
                        <div class="shield"></div>
                        ${this.renderApp(app)}
                    </div>
                `;

                this.space.appendChild(win);
                this.windows[id] = win;
                document.getElementById(`dot-${id}`).classList.add('on');
                
                setTimeout(() => {
                    win.classList.add('show');
                    this.focus(id);
                    this.initLogic(id);
                }, 10);
            }

            renderApp(app) {
                if (app.type === 'iframe' || app.type === 'chat') return `<iframe src="${app.url}"></iframe>`;
                if (app.type === 'app_calc') return `<div class="app-calc"><div class="calc-display" id="c-res">0</div><div class="calc-grid"><button class="calc-btn">7</button><button class="calc-btn">8</button><button class="calc-btn">9</button><button class="calc-btn op">Ã·</button><button class="calc-btn">4</button><button class="calc-btn">5</button><button class="calc-btn">6</button><button class="calc-btn op">Ã—</button><button class="calc-btn">1</button><button class="calc-btn">2</button><button class="calc-btn">3</button><button class="calc-btn op">+</button><button class="calc-btn" style="grid-column: span 2">0</button><button class="calc-btn">.</button><button class="calc-btn op">=</button></div></div>`;
                if (app.type === 'app_term') return `<div class="app-term">Tahoe Kernel v4.0.0-release<br/>root@tahoe-mac ~ % <span id="t-in" contenteditable="true" style="outline:none"></span></div>`;
                if (app.type === 'app_ttt') return `<div class="ttt-container"><h2 id="ttt-h" style="color:#fff;margin-bottom:20px;">Your Turn</h2><div class="ttt-grid" id="ttt-g"></div></div>`;
                if (app.type === 'app_sys') return `<div class="sys-wrap"><h3>Processor Activity</h3><div class="sys-bar"><div class="sys-fill" id="cpu-f"></div></div><h3>Memory Usage</h3><div class="sys-bar"><div class="sys-fill" id="ram-f"></div></div></div>`;
            }

            initLogic(id) {
                if (id === 'sys') {
                    setInterval(() => {
                        document.getElementById('cpu-f').style.width = `${Math.random() * 100}%`;
                        document.getElementById('ram-f').style.width = `${50 + Math.random() * 20}%`;
                    }, 1000);
                }
                if (id === 'ttt') this.initTTT();
                if (id === 'calc') this.initCalc();
            }

            initCalc() {
                const res = document.getElementById('c-res');
                let cur = '';
                document.querySelectorAll('.calc-btn').forEach(b => {
                    b.onclick = () => {
                        const v = b.innerText;
                        if (v === '=') { try { cur = eval(cur.replace('Ã—', '*').replace('Ã·', '/')).toString(); } catch { cur = 'Error'; } }
                        else { cur += v; }
                        res.innerText = cur || '0';
                    };
                });
            }

            initTTT() {
                const g = document.getElementById('ttt-g');
                const h = document.getElementById('ttt-h');
                let b = Array(9).fill(null);
                const check = (m) => {
                    const l = [[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];
                    for(let x of l) if(m[x[0]] && m[x[0]] === m[x[1]] && m[x[0]] === m[x[2]]) return m[x[0]];
                    return m.includes(null) ? null : 'T';
                };
                const minimax = (m, d, isM) => {
                    let r = check(m);
                    if (r === 'O') return 10; if (r === 'X') return -10; if (r === 'T') return 0;
                    if (isM) {
                        let best = -Infinity;
                        for(let i=0; i<9; i++) if(!m[i]){ m[i]='O'; best=Math.max(best, minimax(m, d+1, false)); m[i]=null; }
                        return best;
                    } else {
                        let best = Infinity;
                        for(let i=0; i<9; i++) if(!m[i]){ m[i]='X'; best=Math.min(best, minimax(m, d+1, true)); m[i]=null; }
                        return best;
                    }
                };
                const render = () => {
                    g.innerHTML = '';
                    b.forEach((v, i) => {
                        const c = document.createElement('div');
                        c.className = 'ttt-cell';
                        c.innerText = v || '';
                        c.onclick = () => {
                            if (v || check(b)) return;
                            b[i] = 'X';
                            if (!check(b)) {
                                let best = -Infinity, move;
                                for(let j=0; j<9; j++) if(!b[j]){ b[j]='O'; let s=minimax(b,0,false); b[j]=null; if(s>best){best=s;move=j;}}
                                b[move] = 'O';
                            }
                            render();
                            let win = check(b);
                            if(win) h.innerText = win === 'T' ? "Draw!" : win + " Wins!";
                        };
                        g.appendChild(c);
                    });
                };
                render();
            }

            focus(id) {
                this.zIndex++;
                const win = this.windows[id];
                win.style.zIndex = this.zIndex;
                win.style.display = 'flex';
                setTimeout(() => win.classList.add('show'), 10);
                document.getElementById('active-app-name').innerText = APP_DATA.find(a => a.id === id).name;
            }

            terminate(id) {
                const win = this.windows[id];
                win.classList.remove('show');
                document.getElementById(`dot-${id}`).classList.remove('on');
                setTimeout(() => { win.remove(); delete this.windows[id]; }, 300);
            }

            hide(id) {
                const win = this.windows[id];
                win.classList.remove('show');
                setTimeout(() => win.style.display = 'none', 300);
            }

            dragStart(e, id) {
                const win = this.windows[id];
                this.focus(id);
                const offX = e.clientX - win.offsetLeft;
                const offY = e.clientY - win.offsetTop;
                const shields = document.querySelectorAll('.shield');
                shields.forEach(s => s.style.display = 'block');
                const move = (ev) => { win.style.left = `${ev.clientX - offX}px`; win.style.top = `${ev.clientY - offY}px`; };
                const end = () => {
                    document.removeEventListener('mousemove', move);
                    document.removeEventListener('mouseup', end);
                    shields.forEach(s => s.style.display = 'none');
                };
                document.addEventListener('mousemove', move);
                document.addEventListener('mouseup', end);
            }
        }

        const os = new TahoeOS();
    </script>
</body>
</html>
